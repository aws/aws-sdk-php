{
  "version": 1,
  "defaults": {
    "configuration": {
      "accessKey": "myaccesskey",
      "region": "us-west-2",
      "environmentVariables": {
        "AWS_CSM_ENABLED": "true"
      },
      "sharedConfigFile": {}
    },
    "optionalEventFields": {
      "ApiCall": [],
      "ApiCallAttempt": [
        "AcquireConnectionLatency",
        "DestinationIp",
        "ConnectionReused",
        "ConnectLatency",
        "RequestLatency",
        "DnsLatency",
        "TcpLatency",
        "SslLatency"
      ]
    }
  },
  "cases": [
    {
      "description": "Test a single client API call with Vox-off",
      "configuration": {
        "environmentVariables": {
          "AWS_CSM_ENABLED": "false"
        }
      },
      "apiCalls": [
        {
          "serviceId": "EC2",
          "operationName": "DescribeRegions",
          "params": {},
          "attemptResponses": [
            {
              "httpStatus": 200,
              "responseHeaders": {}
            }
          ]
        }
      ],
      "expectedMonitoringEvents": []
    },
    {
      "description": "Test a single client API call",
      "apiCalls": [
        {
          "serviceId": "EC2",
          "operationName": "DescribeRegions",
          "params": {},
          "attemptResponses": [
            {
              "httpStatus": 200,
              "responseHeaders": {}
            }
          ]
        }
      ],
      "expectedMonitoringEvents": [
        {
          "Type": "ApiCallAttempt",
          "Service": "EC2",
          "Api": "DescribeRegions",
          "ClientId": "",
          "Version": 1,
          "Timestamp": "ANY_INT",
          "AttemptLatency": "ANY_INT",
          "Fqdn": "ec2.us-west-2.amazonaws.com",
          "UserAgent": "ANY_STR",
          "Region": "us-west-2",
          "AccessKey": "myaccesskey",
          "HttpStatusCode": 200
        },
        {
          "Type": "ApiCall",
          "Service": "EC2",
          "Api": "DescribeRegions",
          "ClientId": "",
          "Timestamp": "ANY_INT",
          "Version": 1,
          "AttemptCount": 1,
          "Latency": "ANY_INT"
        }
      ]
    },
    {
      "description": "Test a single client API call with bad request",
      "apiCalls": [
        {
          "serviceId": "EC2",
          "operationName": "DescribeRegions",
          "params": {
            "RegionNames": [
              "some-non-existent-region"
            ]
          },
          "attemptResponses": [
            {
              "httpStatus": 400,
              "responseHeaders": {},
              "errorCode": "InvalidParameterValue",
              "errorMessage": "Invalid region provided"
            }
          ]
        }
      ],
      "expectedMonitoringEvents": [
        {
          "Type": "ApiCallAttempt",
          "Service": "EC2",
          "Api": "DescribeRegions",
          "ClientId": "",
          "Version": 1,
          "Timestamp": "ANY_INT",
          "AttemptLatency": "ANY_INT",
          "Fqdn": "ec2.us-west-2.amazonaws.com",
          "UserAgent": "ANY_STR",
          "Region": "us-west-2",
          "AccessKey": "myaccesskey",
          "HttpStatusCode": 400,
          "AwsException": "InvalidParameterValue",
          "AwsExceptionMessage": "Invalid region provided"
        },
        {
          "Type": "ApiCall",
          "Service": "EC2",
          "Api": "DescribeRegions",
          "ClientId": "",
          "Timestamp": "ANY_INT",
          "Version": 1,
          "AttemptCount": 1,
          "Latency": "ANY_INT"
        }
      ]
    },
    {
      "description": "Test a single client API call with retries",
      "apiCalls": [
        {
          "serviceId": "EC2",
          "operationName": "DescribeRegions",
          "params": {},
          "attemptResponses": [
            {
              "httpStatus": 503,
              "responseHeaders": {},
              "errorCode": "ServiceUnavailable",
              "errorMessage": "Service is unavailable"
            },
            {
              "httpStatus": 200,
              "responseHeaders": {}
            }
          ]
        }
      ],
      "expectedMonitoringEvents": [
        {
          "Type": "ApiCallAttempt",
          "Service": "EC2",
          "Api": "DescribeRegions",
          "ClientId": "",
          "Version": 1,
          "Timestamp": "ANY_INT",
          "AttemptLatency": "ANY_INT",
          "Fqdn": "ec2.us-west-2.amazonaws.com",
          "UserAgent": "ANY_STR",
          "Region": "us-west-2",
          "AccessKey": "myaccesskey",
          "HttpStatusCode": 503,
          "AwsException": "ServiceUnavailable",
          "AwsExceptionMessage": "Service is unavailable"
        },
        {
          "Type": "ApiCallAttempt",
          "Service": "EC2",
          "Api": "DescribeRegions",
          "ClientId": "",
          "Version": 1,
          "Timestamp": "ANY_INT",
          "AttemptLatency": "ANY_INT",
          "Fqdn": "ec2.us-west-2.amazonaws.com",
          "UserAgent": "ANY_STR",
          "Region": "us-west-2",
          "AccessKey": "myaccesskey",
          "HttpStatusCode": 200
        },
        {
          "Type": "ApiCall",
          "Service": "EC2",
          "Api": "DescribeRegions",
          "ClientId": "",
          "Timestamp": "ANY_INT",
          "Version": 1,
          "AttemptCount": 2,
          "Latency": "ANY_INT"
        }
      ]
    },
    {
      "description": "Test a single client API call with non-retryable SDK exception",
      "apiCalls": [
        {
          "serviceId": "EC2",
          "operationName": "DescribeRegions",
          "params": {},
          "attemptResponses": [
            {
              "sdkException": {
                "isRetryable": false,
                "message": "Unexpected exception was thrown"
              }
            }
          ]
        }
      ],
      "expectedMonitoringEvents": [
        {
          "Type": "ApiCallAttempt",
          "Service": "EC2",
          "Api": "DescribeRegions",
          "ClientId": "",
          "Version": 1,
          "Timestamp": "ANY_INT",
          "AttemptLatency": "ANY_INT",
          "Fqdn": "ec2.us-west-2.amazonaws.com",
          "UserAgent": "ANY_STR",
          "Region": "us-west-2",
          "AccessKey": "myaccesskey",
          "SdkException": "ANY_STR",
          "SdkExceptionMessage": "Unexpected exception was thrown"
        },
        {
          "Type": "ApiCall",
          "Service": "EC2",
          "Api": "DescribeRegions",
          "ClientId": "",
          "Timestamp": "ANY_INT",
          "Version": 1,
          "AttemptCount": 1,
          "Latency": "ANY_INT"
        }
      ]
    }
  ]
}